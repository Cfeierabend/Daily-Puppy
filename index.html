<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spot ‚Äî Daily Check-In</title>
  <style>
    :root{
      --bg0:#050814;
      --bg1:#07142f;

      --card: rgba(9, 14, 28, 0.72);
      --border: rgba(255,255,255,0.12);
      --text:#eaf1ff;
      --muted:#a9b9df;

      --shadow: 0 28px 80px rgba(0,0,0,.55);
      --radius: 26px;

      --accentA: rgba(139,92,246,.70);
      --accentB: rgba(59,130,246,.55);
      --accentC: rgba(34,197,94,.40);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      min-height:100%;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:grid;
      place-items:center;
      padding: 26px;
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 18% 12%, rgba(139,92,246,.22), transparent 55%),
        radial-gradient(900px 600px at 84% 18%, rgba(34,197,94,.12), transparent 55%),
        radial-gradient(900px 700px at 50% 90%, rgba(59,130,246,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    /* Animated background layer (kept BEHIND everything) */
    .aurora{
      position:fixed;
      inset:-40%;
      pointer-events:none;
      z-index:0;
      background:
        radial-gradient(circle at 20% 30%, rgba(139,92,246,.35), transparent 55%),
        radial-gradient(circle at 70% 40%, rgba(59,130,246,.25), transparent 55%),
        radial-gradient(circle at 50% 75%, rgba(34,197,94,.18), transparent 60%);
      filter: blur(44px);
      opacity: .85;
      animation: drift 14s ease-in-out infinite alternate;
      mix-blend-mode: screen;
    }
    @keyframes drift{
      0%   { transform: translate3d(-2%, -2%, 0) scale(1.02) rotate(-2deg); }
      100% { transform: translate3d(2%, 2%, 0) scale(1.07) rotate(2deg); }
    }

    /* Subtle grain */
    body:before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      opacity:.07;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.5'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    /* Content wrapper MUST be above background layers */
    .wrap{
      width:min(590px, 100%);
      position:relative;
      z-index:10;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px;
      backdrop-filter: blur(14px);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }

    /* Upgrades change theme via these classes */
    .home-0:after{ opacity:.75; }
    .home-1{ border-color: rgba(59,130,246,.32); }
    .home-2{ border-color: rgba(34,197,94,.30); }
    .home-3{ border-color: rgba(139,92,246,.45); }

    .card:after{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: var(--radius);
      pointer-events:none;
      z-index:0;
      background:
        radial-gradient(720px 240px at 10% 0%, var(--accentA), transparent 60%),
        radial-gradient(620px 220px at 95% 10%, var(--accentC), transparent 60%),
        radial-gradient(700px 260px at 55% 70%, var(--accentB), transparent 65%);
      filter: blur(12px);
      opacity:.9;
      transition: opacity .35s ease;
    }

    .card > *{ position:relative; z-index:1; }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      margin-bottom: 14px;
    }
    .title{ margin:0; font-weight:850; letter-spacing:.02em; font-size:18px; }
    .sub{ margin-top:6px; font-size:12px; color:var(--muted); }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .progress{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      margin-top: 10px;
    }
    .bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(139,92,246,.95), rgba(59,130,246,.70), rgba(34,197,94,.70));
      box-shadow: 0 0 18px rgba(139,92,246,.35);
      transition: width .8s ease;
    }

    .center{ text-align:center; padding: 14px 10px 6px; }

    .emojiRow{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:14px;
      min-height: 96px;
    }
    .emoji{
      font-size: 80px;
      line-height: 1;
      margin: 12px 0 8px;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.45));
      animation: floaty 4.2s ease-in-out infinite;
      user-select:none;
    }
    .emoji.small{
      font-size: 64px;
      opacity: .95;
      animation-duration: 5.1s;
    }
    @keyframes floaty{
      0%,100%{ transform: translateY(0) rotate(0deg); }
      50%{ transform: translateY(-10px) rotate(-1deg); }
    }
    .emoji.ping{
      animation: ping 420ms ease-out 1, floaty 4.2s ease-in-out infinite;
    }
    @keyframes ping{
      0%{ transform: scale(1) }
      50%{ transform: scale(1.08) }
      100%{ transform: scale(1) }
    }

    .status{
      font-size:16px;
      font-weight: 760;
      margin: 6px 0 6px;
    }
    .mood{
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 14px;
      min-height: 18px;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      margin-top: 10px;
    }

    button{
      border:none;
      cursor:pointer;
      padding: 12px 16px;
      border-radius: 16px;
      font-weight: 850;
      font-size: 14px;
      color: var(--text);
      background: linear-gradient(135deg, rgba(139,92,246,.95), rgba(59,130,246,.70));
      box-shadow: 0 16px 34px rgba(139,92,246,.20);
      transition: transform .08s ease, filter .15s ease, box-shadow .2s ease, opacity .15s ease;
      position:relative;
      overflow:hidden;
    }
    button:before{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 50%);
      transform: translateX(-35%) rotate(12deg);
      transition: transform .35s ease;
      opacity:.8;
    }
    button:hover{
      filter: brightness(1.06);
      box-shadow: 0 18px 46px rgba(139,92,246,.26);
    }
    button:hover:before{ transform: translateX(0%) rotate(12deg); }
    button:active{ transform: translateY(1px) scale(.99); }
    button:disabled{
      opacity:.55;
      cursor:default;
      filter:none;
      transform:none;
      box-shadow:none;
    }

    .secondary{
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--muted);
      box-shadow:none;
    }
    .danger{
      background: linear-gradient(135deg, rgba(239,68,68,.92), rgba(245,158,11,.55));
      box-shadow: 0 16px 34px rgba(239,68,68,.18);
    }

    .panel{
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      text-align:left;
    }
    .panel h3{
      margin:0 0 8px;
      font-size: 13px;
      letter-spacing:.02em;
      color: var(--muted);
      font-weight: 850;
      text-transform: uppercase;
    }
    .panel .line{ margin: 6px 0; font-size: 13px; color: var(--text); opacity:.92; }
    .panel .small{ font-size: 12px; color: var(--muted); margin-top: 8px; }

    .footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top: 16px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-size: 12px;
      flex-wrap:wrap;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }

    .finale{
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      line-height: 1.45;
    }
    .finale .muted{ color: var(--muted); font-size: 12px; margin-top: 8px; }
  </style>
</head>

<body>
  <div class="aurora" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card home-0" id="card">
      <div class="top">
        <div>
          <h1 class="title">Daily Check-In</h1>
          <div class="sub" id="subtitle">Initializing Spot‚Ä¶</div>
          <div class="progress" aria-label="progress">
            <div class="bar" id="bar"></div>
          </div>
        </div>
        <div class="pill" id="dayPill">Day ‚Äî / 7</div>
      </div>

      <div class="center">
        <div class="emojiRow">
          <div class="emoji" id="emoji">üê∂</div>
          <div class="emoji small" id="friendEmoji" style="display:none;">üê∂ü©∂</div>
        </div>

        <div class="status" id="status">Loading‚Ä¶</div>
        <div class="mood" id="mood"></div>

        <div class="actions" id="actions"></div>

        <div class="panel" id="panel">
          <h3>Today‚Äôs Situation</h3>
          <div class="line" id="situationLine">‚Äî</div>
          <div class="small" id="hintLine">‚Äî</div>
        </div>

        <div class="finale" id="finale" style="display:none;"></div>
      </div>

      <div class="footer">
        <div class="tag" id="homeTag">üè† Home: Starter</div>
        <div class="tag" id="toyTag">üß∏ Toys: 0</div>
        <div class="tag" id="friendTag">üë• Friend: None</div>
        <div class="tag" id="streakTag">üóìÔ∏è Streak: 0</div>
      </div>
    </div>
  </div>

  <script>
    // =======================
    // SPOT v2 ‚Äî 7 day mini-sim
    // =======================

    const NAME = "Spot";
    const TOTAL_DAYS = 7;
    const LATE_CUTOFF_HOUR = 12; // noon

    // Storage keys (unique)
    const KEY_START = "spot_start_date_v3";
    const KEY_STATE = "spot_state_v3";
    const KEY_DAYLOG = (dayIndex) => `spot_day_${dayIndex}_v3`;

    // Elements
    const cardEl = document.getElementById("card");
    const subtitleEl = document.getElementById("subtitle");
    const dayPillEl = document.getElementById("dayPill");
    const barEl = document.getElementById("bar");
    const emojiEl = document.getElementById("emoji");
    const friendEmojiEl = document.getElementById("friendEmoji");
    const statusEl = document.getElementById("status");
    const moodEl = document.getElementById("mood");
    const actionsEl = document.getElementById("actions");
    const panelSituationEl = document.getElementById("situationLine");
    const panelHintEl = document.getElementById("hintLine");
    const homeTagEl = document.getElementById("homeTag");
    const toyTagEl = document.getElementById("toyTag");
    const friendTagEl = document.getElementById("friendTag");
    const streakTagEl = document.getElementById("streakTag");
    const finaleEl = document.getElementById("finale");

    // Helpers
    function midnight(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
    function daysBetween(a, b){
      const ms = 24*60*60*1000;
      return Math.floor((midnight(b)-midnight(a))/ms);
    }
    function loadJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        return JSON.parse(raw);
      }catch{ return fallback; }
    }
    function saveJSON(key, obj){ localStorage.setItem(key, JSON.stringify(obj)); }
    function ping(el, char){
      el.textContent = char;
      el.classList.remove("ping");
      void el.offsetWidth;
      el.classList.add("ping");
    }

    function initStartDate(){
      let raw = localStorage.getItem(KEY_START);
      if(!raw){
        raw = new Date().toISOString();
        localStorage.setItem(KEY_START, raw);
      }
      return new Date(raw);
    }

    function initState(){
      const existing = loadJSON(KEY_STATE, null);
      if(existing) return existing;

      const state = {
        homeLevel: 0,       // 0..3
        toys: 0,
        friendType: "None", // None | Calm | Chaos | Mysterious
        friendEmoji: null,  // visuals
        streak: 0,
        lastFedDay: null,
        ended: false
      };
      saveJSON(KEY_STATE, state);
      return state;
    }

    function getDayIndex(start){ return daysBetween(start, new Date()); }
    function clampDay(i){ return Math.max(0, Math.min(TOTAL_DAYS-1, i)); }

    const HOME_NAMES = ["Starter", "Better Box", "Cozy Setup", "Chaos Mansion"];

    // Friend ‚Äúcolors‚Äù simulated with emojis
    const FRIEND_VARIANTS = [
      { type:"Calm",       emoji:"üê∂ü§é" },
      { type:"Chaos",      emoji:"üê∂üñ§" },
      { type:"Mysterious", emoji:"üê∂ü©∂" }
    ];

    // One special action per day (plus feed always)
    const SPECIALS = [
      { type:"play",   label:"Play with Spot üéæ",         situation:"Spot has excess energy and questionable intentions.", hint:"Play usually helps. Usually." },
      { type:"upgrade",label:"Upgrade Spot‚Äôs house üè†",   situation:"The current living conditions are‚Ä¶ technically legal.", hint:"Upgrades change the card theme." },
      { type:"toy",    label:"Buy Spot a toy üß∏",         situation:"Spot is staring at the toy aisle in your mind.", hint:"Toys can calm Spot or unlock chaos." },
      { type:"friend", label:"Get Spot a friend üë•",      situation:"Spot is lonely. Or plotting. Hard to tell.", hint:"A new puppy appears. Different ‚Äòcolor.‚Äô" },
      { type:"quiz",   label:"Answer today‚Äôs TRICK question üß†", situation:"A question appears. It is not here to be fair.", hint:"Correct answers are a myth." },
      { type:"upgrade",label:"Upgrade something again üîß", situation:"You feel‚Ä¶ responsible now.", hint:"This is how it starts." },
      { type:"play",   label:"One last play session üéæ",  situation:"Final day energy. Spot is watching closely.", hint:"No pressure. Only consequences." }
    ];

    const TRICK_Q = {
      q: "Choose the correct answer:",
      a: [
        { text: "A) This one.", result: "Incorrect. Confidently.", emoji:"üê∂üòà" },
        { text: "B) That one.", result: "Also incorrect. Elegantly.", emoji:"üê∂üòå" },
        { text: "C) The third option.", result: "Incorrect, but with good vibes.", emoji:"üê∂‚ú®" }
      ],
      after: "Spot judges your logic. Quietly."
    };

    function getDayLog(dayIndex){
      return loadJSON(KEY_DAYLOG(dayIndex), {
        fed:false,
        specialDone:false,
        fedAt:null,
        specialType:null,
        shoeChewed:false,
        note:null
      });
    }
    function saveDayLog(dayIndex, log){ saveJSON(KEY_DAYLOG(dayIndex), log); }

    function applyHouseTheme(level){
      cardEl.classList.remove("home-0","home-1","home-2","home-3");
      cardEl.classList.add(`home-${level}`);
    }

    function renderFriend(state){
      if(state.friendType === "None" || !state.friendEmoji){
        friendEmojiEl.style.display = "none";
        return;
      }
      friendEmojiEl.style.display = "block";
      friendEmojiEl.textContent = state.friendEmoji;
    }

    function progressPercent(dayIndex, endedToday){
      // Always ends at 99%
      if(endedToday) return 99;
      const base = Math.round(((dayIndex) / (TOTAL_DAYS-1)) * 80);
      return Math.min(95, 10 + base);
    }

    function computeSubtitle(dayIndex){
      const hh = new Date().getHours();
      if(dayIndex === 0) return "Welcome. Spot is evaluating you.";
      if(hh >= LATE_CUTOFF_HOUR) return "It‚Äôs past noon. Spot noticed.";
      return "Proceed with calm confidence.";
    }

    function render(){
      const start = initStartDate();
      const state = initState();
      const rawDay = getDayIndex(start);

      // Freeze after day 7
      if(rawDay >= TOTAL_DAYS){
        state.ended = true;
        saveJSON(KEY_STATE, state);
        renderFinale(state);
        return;
      }

      const dayIndex = clampDay(rawDay);
      const dayNum = dayIndex + 1;
      const log = getDayLog(dayIndex);
      const now = new Date();
      const pastNoon = now.getHours() >= LATE_CUTOFF_HOUR;

      const special = SPECIALS[dayIndex];

      // Shoe chew event if not fed by noon (once)
      if(!log.fed && pastNoon && !log.shoeChewed){
        log.shoeChewed = true;
        log.note = "Spot chewed a shoe due to lack of timely snacks.";
        saveDayLog(dayIndex, log);
      }

      applyHouseTheme(state.homeLevel);
      renderFriend(state);

      subtitleEl.textContent = computeSubtitle(dayIndex);
      dayPillEl.textContent = `Day ${dayNum} / ${TOTAL_DAYS}`;

      const endedToday = (dayIndex === TOTAL_DAYS-1) && log.fed && log.specialDone;
      barEl.style.width = `${progressPercent(dayIndex, endedToday)}%`;

      homeTagEl.textContent = `üè† Home: ${HOME_NAMES[state.homeLevel]}`;
      toyTagEl.textContent = `üß∏ Toys: ${state.toys}`;
      friendTagEl.textContent = `üë• Friend: ${state.friendType}`;
      streakTagEl.textContent = `üóìÔ∏è Streak: ${state.streak}`;

      // Status/mood
      if(!log.fed){
        if(pastNoon){
          statusEl.textContent = `${NAME} is mad. He chewed a shoe.`;
          moodEl.textContent = "This is a predictable consequence. Also, it‚Äôs personal.";
          ping(emojiEl, "üê∂üëû");
        } else {
          statusEl.textContent = `${NAME} is waiting.`;
          moodEl.textContent = "He is currently choosing peace.";
          ping(emojiEl, "üê∂");
        }
      } else {
        statusEl.textContent = `${NAME} is full and alert.`;
        moodEl.textContent = log.specialDone
          ? "Daily inputs received. Stability: questionable."
          : "Fed. Still capable of chaos. Choose wisely.";
        ping(emojiEl, "üê∂‚ú®");
      }

      panelSituationEl.textContent = special.situation;
      panelHintEl.textContent = special.hint;

      // Buttons
      actionsEl.innerHTML = "";

      const feedBtn = document.createElement("button");
      feedBtn.textContent = `Feed ${NAME} ü¶¥`;
      feedBtn.disabled = log.fed;
      feedBtn.addEventListener("click", () => doFeed(dayIndex));
      actionsEl.appendChild(feedBtn);

      const specBtn = document.createElement("button");
      specBtn.className = "secondary";
      specBtn.textContent = special.label;
      specBtn.disabled = log.specialDone;
      specBtn.addEventListener("click", () => doSpecial(dayIndex, special.type));
      actionsEl.appendChild(specBtn);

      const restartBtn = document.createElement("button");
      restartBtn.className = "danger";
      restartBtn.textContent = "Restart 7 days (dev)";
      restartBtn.addEventListener("click", restartAll);
      actionsEl.appendChild(restartBtn);

      if(endedToday){
        renderFinale(state);
      } else {
        finaleEl.style.display = "none";
      }
    }

    function doFeed(dayIndex){
      const state = initState();
      const log = getDayLog(dayIndex);
      const now = new Date();
      const isLate = now.getHours() >= LATE_CUTOFF_HOUR;

      log.fed = true;
      log.fedAt = now.toISOString();

      // streak logic
      if(state.lastFedDay === null || state.lastFedDay === dayIndex - 1){
        state.streak += 1;
      } else if(state.lastFedDay !== dayIndex){
        state.streak = 1;
      }
      state.lastFedDay = dayIndex;

      if(isLate){
        log.note = `${NAME} was fed late. He will remember this.`;
        statusEl.textContent = `${NAME} ate. He‚Äôs still judging you.`;
        ping(emojiEl, "üê∂üòë");
      } else {
        log.note = `${NAME} received the daily tribute.`;
        statusEl.textContent = `${NAME} is full and happy-ish.`;
        ping(emojiEl, "üê∂‚ú®");
      }

      saveDayLog(dayIndex, log);
      saveJSON(KEY_STATE, state);
      render();
    }

    function doSpecial(dayIndex, type){
      const state = initState();
      const log = getDayLog(dayIndex);

      log.specialDone = true;
      log.specialType = type;

      if(type === "play"){
        log.note = `${NAME} played. Outcome: joy + minor chaos.`;
        ping(emojiEl, "üê∂üéæ");
        statusEl.textContent = `${NAME} did a happy spin.`;
      } else if(type === "upgrade"){
        state.homeLevel = Math.min(3, state.homeLevel + 1);
        log.note = "Living conditions improved. Theme updated.";
        ping(emojiEl, "üè†‚ú®");
        statusEl.textContent = `${NAME} inspected the upgrade.`;
      } else if(type === "toy"){
        state.toys += 1;
        const roll = Math.random();
        if(roll < 0.35){
          log.note = `Toy acquired. ${NAME} is calm. Suspiciously.`;
          ping(emojiEl, "üß∏üòå");
          statusEl.textContent = `${NAME} loves the toy.`;
        } else {
          log.note = `Toy acquired. ${NAME} used it to invent a new problem.`;
          ping(emojiEl, "üß∏üòà");
          statusEl.textContent = `${NAME} is ‚Äúbusy.‚Äù`;
        }
      } else if(type === "friend"){
        const pick = FRIEND_VARIANTS[Math.floor(Math.random() * FRIEND_VARIANTS.length)];
        state.friendType = pick.type;
        state.friendEmoji = pick.emoji;
        log.note = `A new puppy appeared: ${pick.type}.`;
        friendEmojiEl.style.display = "block";
        ping(friendEmojiEl, pick.emoji);
        ping(emojiEl, "üê∂‚ú®");
        statusEl.textContent = `${NAME} now has a friend: ${pick.type}.`;
      } else if(type === "quiz"){
        runTrickQuiz(dayIndex);
        return;
      }

      saveDayLog(dayIndex, log);
      saveJSON(KEY_STATE, state);
      render();
    }

    function runTrickQuiz(dayIndex){
      const state = initState();
      const log = getDayLog(dayIndex);

      panelSituationEl.textContent = TRICK_Q.q;
      panelHintEl.textContent = "Pick one. Any one. They are all wrong in different ways.";

      actionsEl.innerHTML = "";

      const feedBtn = document.createElement("button");
      feedBtn.textContent = `Feed ${NAME} ü¶¥`;
      feedBtn.disabled = log.fed;
      feedBtn.addEventListener("click", () => doFeed(dayIndex));
      actionsEl.appendChild(feedBtn);

      TRICK_Q.a.forEach(opt => {
        const b = document.createElement("button");
        b.className = "secondary";
        b.textContent = opt.text;
        b.addEventListener("click", () => {
          log.specialDone = true;
          log.specialType = "quiz";
          log.note = `${opt.result} ${TRICK_Q.after}`;

          // Chaotic-neutral bonus anyway
          const roll = Math.random();
          if(roll < 0.25){
            state.homeLevel = Math.min(3, state.homeLevel + 1);
            log.note += " Bonus: accidental house upgrade unlocked.";
          } else if(roll < 0.50){
            state.toys += 1;
            log.note += " Bonus: Spot acquired a suspicious toy.";
          } else {
            log.note += " Bonus: nothing happened. Which is suspicious.";
          }

          saveDayLog(dayIndex, log);
          saveJSON(KEY_STATE, state);

          ping(emojiEl, opt.emoji);
          statusEl.textContent = opt.result;

          render();
        });
        actionsEl.appendChild(b);
      });

      const backBtn = document.createElement("button");
      backBtn.className = "danger";
      backBtn.textContent = "Back";
      backBtn.addEventListener("click", render);
      actionsEl.appendChild(backBtn);
    }

    function renderFinale(state){
      applyHouseTheme(state.homeLevel);
      renderFriend(state);

      subtitleEl.textContent = "Session concluded.";
      dayPillEl.textContent = "Finale";
      barEl.style.width = "99%";

      ping(emojiEl, "üê∂üíÄ");
      statusEl.textContent = "99% complete.";
      moodEl.textContent = "You were so close. The system is unforgiving.";

      panelSituationEl.textContent = "Outcome:";
      panelHintEl.textContent = "No matter what you did‚Ä¶ Spot remembers the one thing you didn‚Äôt.";

      actionsEl.innerHTML = "";
      const restartBtn = document.createElement("button");
      restartBtn.className = "danger";
      restartBtn.textContent = "Restart 7 days";
      restartBtn.addEventListener("click", restartAll);
      actionsEl.appendChild(restartBtn);

      finaleEl.style.display = "block";
      finaleEl.innerHTML = `
        <div style="font-weight:900; font-size:14px; margin-bottom:8px;">
          Final Report (Unavoidable)
        </div>
        <div>
          <span style="color: var(--muted);">Failure to take Spot‚Äôs REAL owner on a date led to him</span>
          <span style="font-weight:900;"> üòµ</span>
        </div>
        <div class="muted">
          This message was generated by Spot. Liability: unknown.
        </div>
      `;
    }

    function restartAll(){
      for(let i=0;i<TOTAL_DAYS;i++) localStorage.removeItem(KEY_DAYLOG(i));
      localStorage.removeItem(KEY_STATE);
      localStorage.removeItem(KEY_START);
      initStartDate();
      initState();
      render();
    }

    // Boot
    initStartDate();
    initState();
    render();
  </script>
</body>
</html>
