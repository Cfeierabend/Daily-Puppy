<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spot ‚Äî 72 Hour Check-In</title>
  <style>
    :root{
      --bg:#0b1222;
      --bg2:#0a1a3a;
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.14);
      --text:#eaf1ff;
      --muted:#a9b9df;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --r: 22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(900px 600px at 25% 20%, rgba(139,92,246,.20), transparent 55%),
                  radial-gradient(900px 600px at 80% 25%, rgba(34,197,94,.12), transparent 55%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      padding: 20px;
    }

    /* simple floating emoji confetti */
    .floaty{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.22;
      z-index:0;
    }
    .floaty span{
      position:absolute;
      font-size: 18px;
      animation: drift 10s linear infinite;
    }
    @keyframes drift{
      from{ transform: translateY(110vh); }
      to{ transform: translateY(-20vh); }
    }

    .card{
      width:min(520px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 18px;
      position:relative;
      z-index:1; /* important */
    }

    .top{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
      margin-bottom: 10px;
    }
    h1{ margin:0; font-size:18px; font-weight:850; letter-spacing:.02em; }
    .sub{ margin-top:6px; font-size:12px; color:var(--muted); }

    .pill{
      font-size:12px;
      color:var(--muted);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    .progress{
      margin-top:10px;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(139,92,246,.9), rgba(59,130,246,.6), rgba(34,197,94,.6));
      transition: width .6s ease;
    }

    .center{ text-align:center; padding: 10px 6px 6px; }

    .emojiRow{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:12px;
      min-height: 92px;
    }
    .emoji{
      font-size: 78px;
      filter: drop-shadow(0 14px 25px rgba(0,0,0,.45));
      animation: bob 3.8s ease-in-out infinite;
      user-select:none;
    }
    .emoji.small{ font-size:58px; opacity:.95; animation-duration:4.6s; }
    @keyframes bob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-10px); }
    }
    .ping{ animation: pop .35s ease-out 1, bob 3.8s ease-in-out infinite; }
    @keyframes pop{
      0%{ transform: scale(1); }
      50%{ transform: scale(1.08); }
      100%{ transform: scale(1); }
    }

    .status{ font-size:16px; font-weight:800; margin: 6px 0 6px; }
    .mood{ font-size:13px; color:var(--muted); margin: 0 0 12px; min-height:18px; }

    .actions{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
      margin-top: 10px;
    }
    button{
      border:none;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 850;
      cursor:pointer;
      color: var(--text);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      transition: transform .08s ease, filter .15s ease;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.55; cursor:default; }

    .primary{
      background: linear-gradient(135deg, rgba(139,92,246,.9), rgba(59,130,246,.55));
      border: none;
    }
    .danger{
      background: linear-gradient(135deg, rgba(239,68,68,.9), rgba(245,158,11,.55));
      border: none;
    }

    .panel{
      margin-top: 14px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      text-align:left;
    }
    .panel h3{
      margin:0 0 6px;
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .06em;
    }
    .line{ font-size: 13px; margin: 6px 0; }
    .hint{ font-size: 12px; color: var(--muted); }

    .footer{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      margin-top: 14px;
      padding-top: 12px;
      border-top:1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-size: 12px;
    }
    .tag{
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
  </style>
</head>
<body>

  <div class="floaty" aria-hidden="true" id="floaty"></div>

  <div class="card" id="card">
    <div class="top">
      <div>
        <h1>72-Hour Check-In</h1>
        <div class="sub" id="subtitle">Initializing Spot‚Ä¶</div>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>
      <div class="pill" id="pill">Day ‚Äî / 3</div>
    </div>

    <div class="center">
      <div class="emojiRow">
        <div class="emoji" id="spot">üê∂</div>
        <div class="emoji small" id="friend" style="display:none;">üê∂ü©∂</div>
      </div>

      <div class="status" id="status">Loading‚Ä¶</div>
      <div class="mood" id="mood"></div>

      <div class="actions" id="actions"></div>

      <div class="panel">
        <h3>Today‚Äôs Situation</h3>
        <div class="line" id="situation">‚Äî</div>
        <div class="hint" id="hint">‚Äî</div>
      </div>

      <div class="panel" id="final" style="display:none;"></div>

      <div class="footer">
        <div class="tag" id="homeTag">üè† Home: Starter</div>
        <div class="tag" id="toyTag">üß∏ Toys: 0</div>
        <div class="tag" id="friendTag">üë• Friend: None</div>
        <div class="tag" id="streakTag">üóìÔ∏è Streak: 0</div>
      </div>
    </div>
  </div>

<script>
  // ====== SPOT 72 HOURS (3 DAYS) ======
  const NAME = "Spot";
  const TOTAL_DAYS = 3;
  const CUTOFF_HOUR = 12; // noon

  const KEY_START = "spot72_start";
  const KEY_STATE = "spot72_state";
  const KEY_DAY = (d) => `spot72_day_${d}`;

  const el = (id)=>document.getElementById(id);
  const spotEl = el("spot");
  const friendEl = el("friend");
  const statusEl = el("status");
  const moodEl = el("mood");
  const subtitleEl = el("subtitle");
  const pillEl = el("pill");
  const barEl = el("bar");
  const actionsEl = el("actions");
  const situationEl = el("situation");
  const hintEl = el("hint");
  const homeTagEl = el("homeTag");
  const toyTagEl = el("toyTag");
  const friendTagEl = el("friendTag");
  const streakTagEl = el("streakTag");
  const finalEl = el("final");
  const cardEl = el("card");

  function ping(node, emoji){
    node.textContent = emoji;
    node.classList.remove("ping");
    void node.offsetWidth;
    node.classList.add("ping");
  }

  function loadJSON(k, fallback){
    try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : fallback; }
    catch{ return fallback; }
  }
  function saveJSON(k, v){ localStorage.setItem(k, JSON.stringify(v)); }

  function initStart(){
    let s = localStorage.getItem(KEY_START);
    if(!s){
      s = Date.now().toString();
      localStorage.setItem(KEY_START, s);
    }
    return Number(s);
  }

  function initState(){
    const s = loadJSON(KEY_STATE, null);
    if(s) return s;
    const state = { home:0, toys:0, friendType:"None", friendEmoji:null, streak:0, lastFedDay:null };
    saveJSON(KEY_STATE, state);
    return state;
  }

  function dayIndexFromStart(startMs){
    const now = Date.now();
    const hours = (now - startMs) / (1000*60*60);
    return Math.floor(hours / 24); // 0,1,2
  }

  function getDayLog(day){
    return loadJSON(KEY_DAY(day), { fed:false, special:false, shoe:false });
  }
  function setDayLog(day, log){ saveJSON(KEY_DAY(day), log); }

  const HOME_NAMES = ["Starter", "Better Box", "Cozy Setup", "Chaos Mansion"];
  const FRIENDS = [
    { type:"Calm", emoji:"üê∂ü§é" },
    { type:"Chaos", emoji:"üê∂üñ§" },
    { type:"Mysterious", emoji:"üê∂ü©∂" }
  ];

  const SPECIALS = [
    { type:"play", label:"Play üéæ", situation:"Spot is bored and plotting.", hint:"Play reduces crime (maybe)." },
    { type:"upgrade", label:"Upgrade house üè†", situation:"The home is‚Ä¶ barely acceptable.", hint:"Upgrades change the vibe." },
    { type:"friend", label:"Get a friend üë•", situation:"Spot wants another puppy.", hint:"Adds variables. Nerd approved." }
  ];

  // simple floating emojis
  function seedFloaty(){
    const container = document.getElementById("floaty");
    const em = ["‚ú®","ü¶¥","üß∏","üíú","üíô","üíö","üëû"];
    for(let i=0;i<18;i++){
      const s = document.createElement("span");
      s.textContent = em[Math.floor(Math.random()*em.length)];
      s.style.left = Math.floor(Math.random()*100) + "vw";
      s.style.animationDuration = (7 + Math.random()*7) + "s";
      s.style.animationDelay = (-Math.random()*10) + "s";
      s.style.opacity = (0.12 + Math.random()*0.25).toFixed(2);
      container.appendChild(s);
    }
  }

  function applyHomeTheme(home){
    // reliable: just border color changes
    cardEl.style.borderColor =
      home === 0 ? "rgba(255,255,255,0.14)" :
      home === 1 ? "rgba(59,130,246,0.38)" :
      home === 2 ? "rgba(34,197,94,0.34)" :
                   "rgba(139,92,246,0.46)";
  }

  function render(){
    const start = initStart();
    const state = initState();
    const day = dayIndexFromStart(start);

    // End after 72 hours OR after 3 days
    const hours = (Date.now() - start) / (1000*60*60);
    if(hours >= 72 || day >= TOTAL_DAYS){
      renderFinal(state);
      return;
    }

    const d = Math.max(0, Math.min(TOTAL_DAYS-1, day));
    const dayNum = d + 1;
    const log = getDayLog(d);
    const now = new Date();
    const pastNoon = now.getHours() >= CUTOFF_HOUR;

    // Shoe event if not fed by noon (once per day)
    if(!log.fed && pastNoon && !log.shoe){
      log.shoe = true;
      setDayLog(d, log);
    }

    applyHomeTheme(state.home);

    subtitleEl.textContent = (pastNoon ? "It‚Äôs past noon. Spot noticed." : "New day. New choices.");
    pillEl.textContent = `Day ${dayNum} / ${TOTAL_DAYS}`;

    // progress: day 1 ~33%, day 2 ~66%, day 3 ~95%
    const pct = d===0 ? 33 : d===1 ? 66 : 95;
    barEl.style.width = pct + "%";

    homeTagEl.textContent = `üè† Home: ${HOME_NAMES[state.home]}`;
    toyTagEl.textContent = `üß∏ Toys: ${state.toys}`;
    friendTagEl.textContent = `üë• Friend: ${state.friendType}`;
    streakTagEl.textContent = `üóìÔ∏è Streak: ${state.streak}`;

    // friend render
    if(state.friendType !== "None" && state.friendEmoji){
      friendEl.style.display = "block";
      friendEl.textContent = state.friendEmoji;
    } else {
      friendEl.style.display = "none";
    }

    // status/mood
    if(!log.fed){
      if(pastNoon){
        statusEl.textContent = `${NAME} is mad. He chewed a shoe.`;
        moodEl.textContent = "This was avoidable. But now it‚Äôs lore.";
        ping(spotEl, "üê∂üëû");
      } else {
        statusEl.textContent = `${NAME} is waiting.`;
        moodEl.textContent = "He is currently pretending to be patient.";
        ping(spotEl, "üê∂");
      }
    } else {
      statusEl.textContent = `${NAME} is fed.`;
      moodEl.textContent = log.special ? "Inputs received. Chaos stabilized." : "Fed but still mischievous.";
      ping(spotEl, "üê∂‚ú®");
    }

    // panel
    const special = SPECIALS[d];
    situationEl.textContent = special.situation;
    hintEl.textContent = special.hint;

    // buttons
    actionsEl.innerHTML = "";

    const feedBtn = document.createElement("button");
    feedBtn.className = "primary";
    feedBtn.textContent = `Feed ${NAME} ü¶¥`;
    feedBtn.disabled = log.fed;
    feedBtn.onclick = () => {
      log.fed = true;
      setDayLog(d, log);

      // streak
      if(state.lastFedDay === null || state.lastFedDay === d-1) state.streak += 1;
      else if(state.lastFedDay !== d) state.streak = 1;
      state.lastFedDay = d;
      saveJSON(KEY_STATE, state);

      render();
    };
    actionsEl.appendChild(feedBtn);

    const specBtn = document.createElement("button");
    specBtn.textContent = special.label;
    specBtn.disabled = log.special;
    specBtn.onclick = () => {
      log.special = true;
      setDayLog(d, log);

      if(special.type === "play"){
        ping(spotEl, "üê∂üéæ");
        statusEl.textContent = "Spot zoomed.";
      }
      if(special.type === "upgrade"){
        state.home = Math.min(3, state.home + 1);
        saveJSON(KEY_STATE, state);
        ping(spotEl, "üè†‚ú®");
        statusEl.textContent = "Upgrade installed. Spot has standards now.";
      }
      if(special.type === "friend"){
        const pick = FRIENDS[Math.floor(Math.random()*FRIENDS.length)];
        state.friendType = pick.type;
        state.friendEmoji = pick.emoji;
        saveJSON(KEY_STATE, state);
        friendEl.style.display = "block";
        ping(friendEl, pick.emoji);
        ping(spotEl, "üê∂‚ú®");
        statusEl.textContent = `New friend unlocked: ${pick.type}.`;
      }
      render();
    };
    actionsEl.appendChild(specBtn);

    const resetBtn = document.createElement("button");
    resetBtn.className = "danger";
    resetBtn.textContent = "Restart (dev)";
    resetBtn.onclick = resetAll;
    actionsEl.appendChild(resetBtn);

    finalEl.style.display = "none";
  }

  function renderFinal(state){
    // Freeze ending
    pillEl.textContent = "Finale";
    subtitleEl.textContent = "72 hours concluded.";
    barEl.style.width = "99%";
    applyHomeTheme(state.home);

    statusEl.textContent = "99% complete.";
    moodEl.textContent = "You were so close. The system is unforgiving.";
    ping(spotEl, "üê∂üíÄ");

    situationEl.textContent = "Outcome:";
    hintEl.textContent = "No matter what you did‚Ä¶ Spot remembers the one thing you didn‚Äôt.";

    actionsEl.innerHTML = "";
    const restart = document.createElement("button");
    restart.className = "danger";
    restart.textContent = "Restart 72 hours";
    restart.onclick = resetAll;
    actionsEl.appendChild(restart);

    finalEl.style.display = "block";
    finalEl.innerHTML = `
      <h3>Final Report (Unavoidable)</h3>
      <div class="line">
        <span style="color: var(--muted);">Failure to take Spot‚Äôs REAL owner on a date led to him</span>
        <span style="font-weight:900;"> üòµ</span>
      </div>
      <div class="hint">This message was generated by Spot. Liability: unknown.</div>
    `;
  }

  function resetAll(){
    for(let i=0;i<TOTAL_DAYS;i++) localStorage.removeItem(KEY_DAY(i));
    localStorage.removeItem(KEY_STATE);
    localStorage.removeItem(KEY_START);
    initStart();
    initState();
    render();
  }

  seedFloaty();
  initStart();
  initState();
  render();
</script>
</body>
</html>
